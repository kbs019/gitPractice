<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>MyPage</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<body>    
    <center><h1>마이페이지</h1></center>

    <!-- 내 정보 영역 -->
    <div id="myInfoSection">
        <h2>내 정보</h2>
        <div id="myInfoView">
            <!-- 사용자 정보가 여기에 표시됩니다 -->
        </div>

        <button onclick="showUpdateForm()">수정</button>
        <div id="myInfoEdit" style="display:none;">
            <p>비밀번호: <input type="password" id="pw" required></p>
            <p>닉네임: <input type="text" id="nick" required></p>
            <p>이메일: <input type="text" id="email" required></p>
            <p>휴대폰번호: <input type="text" id="phone" required></p>
            <label for="carrier">통신사:</label>
            <select name="carrier" id="carrier" required>
                <option value="SKT">SKT</option>
                <option value="KT">KT</option>
                <option value="LG U+">LG U+</option>
                <option value="알뜰폰">알뜰폰</option>
            </select>
            <br><br>
            <button onclick="updateMyInfo()">수정 완료</button>
            <button onclick="deleteUser()">회원 탈퇴</button>
        </div>
    </div>

    <hr>

    <!-- 강아지 정보 영역 -->
    <div id="petSection">
        <h2>강아지 정보</h2>
        <div id="petList">
            <!-- 강아지 목록이 여기에 표시됩니다 -->
        </div>
        <button onclick="showPetInsertForm()">강아지 추가</button>
        <div id="petForm" style="display:none;">
            <input type="hidden" id="petNo">
            <p><input type="text" id="petName" placeholder="이름"></p>
            <p><input type="text" id="petBreed" placeholder="견종"></p>
            <p><input type="number" id="petAge" placeholder="나이"></p>
            <p><input type="text" id="petSize" placeholder="크기"></p>
            <p><input type="text" id="petWeight" placeholder="몸무게"></p>
            <p><input type="date" id="petBirth"></p>
            <button onclick="submitPet()">저장</button>
        </div>
    </div>

    <hr>

    내가 쓴 글 영역
    <div id="postSection">
        <h2>내가 쓴 글</h2>
        <button onclick="loadPosts()">글 보기</button>
        <div id="myPosts"></div>
    </div>

<script>
$(document).ready(function() {
    loadMyInfo();
    loadPets();
});

function loadMyInfo() {
    $.post('/myPage/getUser', function(data) {
        $('#myInfoView').html(`
            <p>닉네임: ${data.nick}</p>
            <p>이메일: ${data.email}</p>
            <p>전화번호: ${data.phone}</p>
            <p>통신사: ${data.carrier}</p>
        `);
    });
}

function showUpdateForm() {
    $('#myInfoEdit').show();
    $(event.target).hide();
}

function updateMyInfo() {
    $.ajax({
        url: '/myPage/updateUser',
        method: 'POST',
        data: {
            pw: $('#pw').val(),
            nick: $('#nick').val(),
            email: $('#email').val(),
            phone: $('#phone').val(),
            carrier: $('#carrier').val()
        },
        success: function(res) {
            alert('수정 완료');
            loadMyInfo();
        }
    });
}

function deleteUser() {
    if (!confirm('정말 탈퇴하시겠습니까?')) return;
    $.post('/myPage/deleteUser', function(res) {
        alert('탈퇴 처리되었습니다');
        location.href = '/';
    });
}

function loadPets() {
    $.post('/myPage/getPet', function(list) {
        let html = '';
        list.forEach(pet => {
            html += `
                <div class="pet-card">
                    <p>이름: ${pet.petName}</p>
                    <p>견종: ${pet.petBreed}</p>
                    <p>나이: ${pet.petAge}</p>
                    <button onclick="editPet(${pet.petNo})">수정</button>
                    <button onclick="deletePet(${pet.petNo})">삭제</button>
                </div>
            `;
        });
        $('#petList').html(html);
    });
}

function showPetInsertForm() {
    $('#petForm').show();
    $('#petForm input').val('');
    $('#petNo').val('');
}

function editPet(petNo) {
    $.post(`/myPage/getPet?petNo=${petNo}`, function(pet) {
        $('#petForm').show();
        $('#petNo').val(pet.petNo);
        $('#petName').val(pet.petName);
        $('#petBreed').val(pet.petBreed);
        $('#petAge').val(pet.petAge);
        $('#petSize').val(pet.petSize);
        $('#petWeight').val(pet.petWeight);
        $('#petBirth').val(pet.petBirth);
    });
}

function submitPet() {
    const pet = {
        petNo: $('#petNo').val(),
        petName: $('#petName').val(),
        petBreed: $('#petBreed').val(),
        petAge: $('#petAge').val(),
        petSize: $('#petSize').val(),
        petWeight: $('#petWeight').val(),
        petBirth: $('#petBirth').val()
    };
    const url = pet.petNo ? '/myPage/updatePet' : '/myPage/addDog';
    $.ajax({
        url,
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(pet),
        success: function() {
            alert('처리 완료');
            loadPets();
        }
    });
}

function deletePet(petNo) {
    $.post('/myPage/deletePet', { petNo }, function() {
        alert('삭제 완료');
        loadPets();
    });
}

function loadPosts() {
    $.post('/myPage/myPosts', function(posts) {
        let html = '';
        posts.forEach(p => {
            html += `<p>${p.title} (${p.boardType})</p>`;
        });
        $('#myPosts').html(html);
    });
}
</script>
</body>
</html>
